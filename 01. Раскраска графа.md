# Раскраска графа

Раскраска графа – это фундаментальная задача в теории графов. В наиболее общем смысле, под **раскраской вершин графа** понимается присвоение каждой вершине графа некоторой "цветной" метки таким образом, чтобы выполнялось основное условие: **любые две смежные вершины (т.е. соединенные ребром) должны иметь разные цвета.**

Из-за этого основного условия, графы, содержащие **петли** (ребра, соединяющие вершину саму с собой), не могут быть раскрашены таким образом, поэтому мы будем рассматривать графы без петель.

**Хроматическое число графа** $(\chi(G))$ — минимальное количество цветов, необходимое для осуществления правильной раскраски вершин графа $G$.

Рассмотрим полный граф $K_{n}$. Это граф с $n$ вершинами, в котором каждая пара различных вершин соединена ребром. В таком графе каждая вершина смежна всем остальным $n-1$ вершинам. Следовательно, все $n$ вершин должны иметь разные цвета.

## Алгоритм полного перебора

**Идея:** Сгенерировать все возможные раскраски графа в $k$ цветов и проверить каждую на корректность.

**Проверка корректности раскраски:** Для данной раскраски нужно пройтись по всем ребрам графа $(u,v)$ и убедиться, что цвет вершины $u$ не совпадает с цветом вершины $v$. Если в графе $V$ вершин и $E$ ребер, сложность такой проверки составляет $O(V+E)$ или $O(E)$ в зависимости от представления графа.

**Генерация раскрасок:** Если у нас $n$ вершин и мы пытаемся использовать $k$ цветов, то для каждой вершины есть $k$ вариантов выбора цвета. Всего существует $k^n$ возможных раскрасок. 
Для задачи 3-раскраски, количество возможных раскрасок равно $3^n$.

**Сложность алгоритма:** $O(k^n(V+E))$. Для 3-раскраски: $O(3^n(V+E))$.
Это экспоненциальная сложность. Несмотря на то, что существуют более эффективные точные алгоритмы (например, для 3-раскраски лучший известный имеет сложность порядка $O(1.3289^n)$), экспоненциальную зависимость от $n$ устранить пока не удалось.

## Перебор с учетом выбора только из 2 цветов

Пусть есть некоторая вершина. Красим ее в первый цвет. Для инцидентных вершин выбор идет не из 3-х цветов, а из 2-х. Сложность такого алгоритма - $O(2^n)$.

Другими словами, используется знание, что инцидентные данной вершины нельзя красить в цвет данной.

## Перебор подможеств размера $\leq \frac{n}{3}$

Данный алгоритм для задачи 3-раскраски графа $G=(V,E)$ с $n=|V|$ вершинами и $m=|E|$ ребрами основывается на двух ключевых соображениях:

1. **Структура 3-раскраски:** Если граф $G$ допускает 3-раскраску, то его множество вершин $V$ может быть разбито на три непересекающихся независимых множества $C_{1},C_{2},C_{3}$, соответствующие трем цветам. Согласно принципу Дирихле, по крайней мере одно из этих множеств (цветовых классов) будет содержать не более $\left\lfloor  \frac{n}{3}  \right\rfloor$ вершин.
2. **Редукция к 2-раскраске:** Если нам известно одно из таких независимых множеств, скажем $C_{1}$, то оставшиеся вершины $V'=V\setminus C_{1}$ должны быть раскрашены в два оставшихся цвета. Задача определения, можно ли раскрасить граф, индуцированный на $V'$, в два цвета (то есть является ли он двудольным), решается за линейное время $O(|V'|+|E'|)$, где $E'$ — ребра в индуцированном подграфе $G[V']$.

Идея алгоритма заключается в том, чтобы перебрать все возможные подмножества $S \subseteq V$ такие, что $|S|\leq \left\lfloor  \frac{n}{3}  \right\rfloor$. Для каждого такого $S$:

1. Предполагаем, что $S$ является одним из цветовых классов (например, все вершины в $S$ окрашены первым цветом).
2. Проверяем, является ли $S$ независимым множеством. Если нет (т.е. существуют $u,v\in S$ такие, что $(u,v)\in E$), то $S$ не может быть цветовым классом, и мы переходим к следующему кандидату $S$.
3. Если $S$ — независимое множество, пытается 2-раскрасить подграф $G[V\setminus S]$, используя два оставшихся цвета. Если это удается, то 3-раскраска для $G$ найдена.

**Анализ сложности:** Количество подмножеств $S$ размера $k$ равно $C(n,k)$. Общее число перебираемых подмножеств равно:
$$C^0_{n}+C^1_{n}+C^2_{n}+\dots+C^{n/3}_{n}\leq nC^{n/3}_{n}\leq 1.9^n.$$
Значит, сложность алгоритма — $O(1.9^n)$.

## Вероятностный алгоритм (Two-List Coloring). Сведение к задаче 2-выполнимости (2-SAT)

Предположим, что для каждой вершины графа $G=(V,E)$ мы случайным образом выбираем и "запрещаем" один из трех доступных цветов. В результате для каждой вершины $v_{i}\in V$ формируется список $L_{i}$ из двух разрешенных цветов. Задача теперь состоит в том, чтобы найти такую раскраску, где цвет каждой вершины $v_{i}$ выбирается из ее списка $L_{i}$, и смежные вершины имеют разные цвета.

**Сведение к 2-SAT**:

1. **Формирование списков:** Для каждой вершины $v_{i}\in V$ случайно и независимо от других вершин удаляется один цвет из множества $\{1,2,3\}$. Пусть $L_{i}=\{c_{i1}, c_{i 2}\}$ — список двух оставшихся разрешенных цветов для $v_{i}$.
2. **Определение переменных:** Для каждой вершины $v_{i}$ и каждого цвета $c\in L_{i}$ введем булеву переменную $x_{i,c}$, которая истинна, если вершина $v_{i}$ окрашена в цвет $c$, и ложна в противном случае.
3. **Формулирование ограничений:**
	- **Каждая вершина должна быть окрашена ровно в один цвет из ее списка:** Для каждой вершины $v_{i}$ с $L_{i}=\{c_{i 1}, c_{i 2}\}$:
		- Вершина должна быть окрашена хотя бы в один цвет из $L_{i}$: $(x_{i, c_{i 1}} \vee x_{i,c_{i 2}})$.
		- Вершина не может быть окрашена в оба цвета из $L_{i}$: $(\neg x_{i,c_{i 1}}\vee \neg x_{i,c_{i 2}})$. (Это ограничение гарантирует, что если один выбран, другой не выбран).
	- **Смежные вершины должны иметь разные цвета:** Для каждого ребра $(v_{i},v_{j})\in E$:
			Если цвет $k$ присутствует в обоих списках, $k\in L_{i}$ и $k\in L_{j}$, то вершины $v_{i}$ и $v_{j}$ не могут быть одновременно окрашены в цвет $k$: $(\neg x_{i,k}\vee \neg x_{j,k})$. Это ограничение добавляется для каждого такого общего цвета $k$.

Полученная конъюнкция дизъюнктов, где каждый дизъюнкт содержит не более двух литералов, является экземпляром задачи 2-SAT. Задача 2-SAT может быть решена за полиномиальное время (например, $O(N+M)$, где $N$ — число переменных, $M$  — число ограничений).

Задачу 2SAT возможно свести к графу, и решением будет поиск компонент связности.

Если найдено решение задачи, то граф точно может быть раскрашен, но обратное неверно — возможно, мы вычеркнули нужные цвета для раскраски. Вероятность того, что раскраска выживет после вычеркивания — $\left( \frac{2}{3} \right)^n$. Это очень мало.

Но если прогнать алгоритм $\left( \frac{3}{2} \right)^n$ раз, то вероятность ошибки — $\frac{1}{e}$.

Если после этого прогнать еще 100 раз, то вероятность ошибки — $\frac{1}{e^{100}}$.

Сложность алгоритма — $O(1.5^n)$.

## Применение

- Задача планирования. Пусть есть список заказов, которые начинаются и заканчиваются в определенное время. Нужно понять, какое минимальное количество ресурсов нужно выделить для решения этих заказов. Сводится так: пересечение заказов по времени - ребро графа. Хроматическое число графа и есть ответ.
- Есть карта - отображение информации, которое предполагает, что между объектами есть границы (например - политическая карта мира). Задача - определить минимальное число цветов раскрасить карту, чтобы были видны границы между объектами. Задача очевидным образов сводится к раскраске графа.
- Задача оптимального распределения переменных по регистрам.
